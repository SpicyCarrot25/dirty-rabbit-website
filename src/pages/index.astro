---
import Layout from '../layouts/Layout.astro';
import { getTranslations, getLocalizedPath } from '../i18n';
import proveedores from '../data/proveedores.json';

const lang = 'es';
const t = getTranslations(lang);

// Featured providers for homepage (curated selection)
const featuredIds = ['la-cabra', 'origo-bakery', 'la-puntual', 'buddy-buddy'];
const featuredProviders = featuredIds.map(id => proveedores.find(p => p.id === id)).filter(Boolean);
---

<Layout title="Dirty Rabbit — Specialty Coffee, Breakfast & Brunch · S'Agaró" lang={lang}>
  
  <!-- HERO SECTION: 100vh, full-bleed photo, centered tagline, NO scroll indicator -->
  <section class="relative h-screen flex items-center justify-center overflow-hidden -mt-16 md:-mt-20">
    <!-- Background: Video of La Marzocco (GIF-like behavior) -->
    <div class="absolute inset-0 bg-black" id="hero-bg">
      <video 
        autoplay 
        muted 
        loop 
        playsinline
        webkit-playsinline
        disablePictureInPicture
        preload="auto"
        class="w-full h-full object-cover pointer-events-none"
      >
        <source src="/photos/hero-video.mp4" type="video/mp4" />
      </video>
      <!-- Dark overlay for text readability -->
      <div class="absolute inset-0 bg-black/40"></div>
    </div>
    
    <!-- Hero Content: Centered tagline only -->
    <div class="relative z-10 text-center text-white px-6 max-w-4xl mx-auto">
      <p class="reveal font-typewriter text-3xl md:text-5xl lg:text-6xl leading-relaxed hero-text-shadow">
        Mañanas tranquilas.<br class="hidden sm:block" /> 
        Risas fáciles.<br class="hidden sm:block" /> 
        Coffee in between.
      </p>
    </div>
    
    <!-- No scroll indicator per design spec -->
  </section>
  
  
  <!-- COMMUNITY SECTION: Post-hero, no headline, elegant typography -->
  <section class="py-16 md:py-24 bg-white">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <p class="reveal font-typewriter text-xl md:text-2xl lg:text-3xl leading-relaxed text-black/80 mb-10">
        La familia con el niño que no para. La pareja que viene desde el primer día. El que acaba de mudarse y no conoce a nadie todavía. Aquí se viene a desayunar bien, a tomar café de verdad, y a quedarse un rato. Desconocidos que se vuelven clientes que se vuelven amigos. Specialty coffee, brunch y desayunos yummy en S'Agaró, en el corazón de la Costa Brava.
      </p>
      
      <!-- CTA Buttons -->
      <div class="reveal flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href={getLocalizedPath('/menu', lang)}
          class="inline-block font-typewriter text-lg px-8 py-3 border-2 border-red text-red hover:bg-red hover:text-white transition-colors rounded-lg"
        >
          Carta
        </a>
        <a 
          href="https://order.dirtyrabbit.es"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block font-typewriter text-lg px-8 py-3 bg-red text-white hover:bg-red/90 transition-colors rounded-lg"
        >
          Pide Ahora
        </a>
      </div>
    </div>
  </section>
  
  
  <!-- PROVIDERS: 4 cards grid, same style as news cards -->
  <section class="py-12 md:py-20 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Section Header -->
      <div class="text-center mb-12 md:mb-16 reveal">
        <h2 class="font-typewriter text-5xl md:text-6xl lg:text-7xl mb-4 section-headline">
          Proveedores
        </h2>
        <p class="font-mono text-sm text-black/60 max-w-xl mx-auto">
          La gente detrás de tu taza
        </p>
      </div>
      
      <!-- Horizontal Slider - Square cards with text overlay -->
      <div class="news-slider -mx-4 px-4 md:mx-0 md:px-0">
        {featuredProviders.map((p, i) => {
          const images = [
            '/photos/photo3.jpg', // La Cabra - wine glasses + coffee bags
            '/photos/photo4.jpg', // REQ Matcha - chocolate detail
            '/photos/photo2.jpg', // Awachai - wine bottles
            '/photos/photo1.jpg', // Bioma - flowers vase
          ];
          return (
          <article class="reveal card-lift relative aspect-square w-[70vw] md:w-[280px] rounded-xl overflow-hidden border border-[#1A1A1A]">
            <!-- Background image -->
            <div class="absolute inset-0">
              <img 
                src={images[i] || images[0]}
                alt={p.name}
                class="w-full h-full object-cover"
              />
            </div>
            <!-- Text overlay at bottom -->
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 via-black/50 to-transparent pt-16">
              <p class="font-mono text-xs text-white/80 tracking-wider mb-1">
                {(p.category as any)[lang]}
              </p>
              <h3 class="font-typewriter text-lg text-white">
                {p.name}
              </h3>
              <p class="font-mono text-xs text-white/70">
                {p.origin ? `${p.origin}` : ''}
              </p>
            </div>
          </article>
          );
        })}
      </div>
      
      <!-- View All Link -->
      <div class="text-center mt-12 reveal">
        <a 
          href={getLocalizedPath('/proveedores', lang)}
          class="inline-flex items-center gap-2 font-typewriter text-red hover:text-red/80 transition-colors group"
        >
          Ver todos los proveedores
          <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>
      
    </div>
  </section>
  
  
  <!-- NEWS CARDS: Cream background, horizontal slider (Big Mamma style) -->
  <section class="py-20 md:py-32 bg-cream">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      
      <!-- Section Header - Large title hierarchy (Basora style) -->
      <div class="text-center mb-12 md:mb-16 reveal">
        <h2 class="font-typewriter text-5xl md:text-6xl lg:text-7xl mb-4 section-headline">
          News y Momentos
        </h2>
        <p class="font-mono text-sm text-black/60 max-w-xl mx-auto">
          Lo último de Dirty Rabbit
        </p>
      </div>
      
      <!-- Horizontal Slider -->
      <div class="news-slider -mx-4 px-4 md:mx-0 md:px-0">
        
        <!-- Card 1 - Running Club -->
        <article class="reveal card-lift bg-white border border-[#1A1A1A] rounded-xl overflow-hidden w-[80vw] md:w-[calc(33.333%-1rem)] max-w-[380px]">
          <div class="aspect-square relative overflow-hidden">
            <img 
              src="/photos/photo1.jpg"
              alt="Running club"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="p-6">
            <time class="font-mono text-xs text-red tracking-wider">
              Ene 2025
            </time>
            <h3 class="font-typewriter text-xl md:text-2xl mt-3 mb-2 text-black">
              Running Club: ya somos 20
            </h3>
            <p class="font-mono text-sm text-black/60 line-clamp-2">
              Cada martes a las 8am. 5km por la costa y café después. Ya se han hecho amistades.
            </p>
          </div>
        </article>
        
        <!-- Card 2 - Primera temporada -->
        <article class="reveal card-lift bg-white border border-[#1A1A1A] rounded-xl overflow-hidden w-[80vw] md:w-[calc(33.333%-1rem)] max-w-[380px]">
          <div class="aspect-square relative overflow-hidden">
            <img 
              src="/photos/photo3.jpg"
              alt="Café interior"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="p-6">
            <time class="font-mono text-xs text-red tracking-wider">
              Dic 2024
            </time>
            <h3 class="font-typewriter text-xl md:text-2xl mt-3 mb-2 text-black">
              Primera temporada: gracias
            </h3>
            <p class="font-mono text-sm text-black/60 line-clamp-2">
              De desconocidos a amigos. La primera season fue más bonita de lo que imaginábamos.
            </p>
          </div>
        </article>
        
        <!-- Card 3 - Apertura -->
        <article class="reveal card-lift bg-white border border-[#1A1A1A] rounded-xl overflow-hidden w-[80vw] md:w-[calc(33.333%-1rem)] max-w-[380px]">
          <div class="aspect-square relative overflow-hidden">
            <img 
              src="/photos/photo2.jpg"
              alt="Coffee shop opening"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="p-6">
            <time class="font-mono text-xs text-red tracking-wider">
              Nov 2024
            </time>
            <h3 class="font-typewriter text-xl md:text-2xl mt-3 mb-2 text-black">
              Abrimos en S'Agaró
            </h3>
            <p class="font-mono text-sm text-black/60 line-clamp-2">
              Después de meses de trabajo, el conejo ha encontrado su madriguera. Bienvenidos.
            </p>
          </div>
        </article>
        
        <!-- Card 4 - La Cabra -->
        <article class="reveal card-lift bg-white border border-[#1A1A1A] rounded-xl overflow-hidden w-[80vw] md:w-[calc(33.333%-1rem)] max-w-[380px]">
          <div class="aspect-square relative overflow-hidden">
            <img 
              src="/photos/photo4.jpg"
              alt="La Cabra coffee"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="p-6">
            <time class="font-mono text-xs text-red tracking-wider">
              Nov 2024
            </time>
            <h3 class="font-typewriter text-xl md:text-2xl mt-3 mb-2 text-black">
              Café de La Cabra
            </h3>
            <p class="font-mono text-sm text-black/60 line-clamp-2">
              Copenhagen en tu taza. El mejor tostador de Europa ahora en Costa Brava.
            </p>
          </div>
        </article>
        
      </div>
      
      <!-- View All Link -->
      <div class="text-center mt-12 reveal">
        <a 
          href={getLocalizedPath('/news', lang)}
          class="inline-flex items-center gap-2 font-typewriter text-red hover:text-red/80 transition-colors group"
        >
          Ver todas las noticias
          <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>
      
    </div>
  </section>
  
  
  </Layout>

<script>
  // Fade-in on scroll - Vanilla JS with IntersectionObserver
  document.addEventListener('DOMContentLoaded', () => {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    if (prefersReducedMotion) {
      // Show all elements immediately if reduced motion preferred
      document.querySelectorAll('.reveal').forEach(el => {
        el.classList.add('visible');
      });
      return;
    }
    
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry, index) => {
          if (entry.isIntersecting) {
            // Stagger the animation slightly
            setTimeout(() => {
              entry.target.classList.add('visible');
            }, index * 100);
            observer.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      }
    );
    
    document.querySelectorAll('.reveal').forEach(el => {
      observer.observe(el);
    });
    
    // Simple parallax for hero background
    const heroBg = document.getElementById('hero-bg');
    if (heroBg) {
      let ticking = false;
      
      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            const scrolled = window.pageYOffset;
            const rate = scrolled * 0.3;
            heroBg.style.transform = `translateY(${rate}px)`;
            ticking = false;
          });
          ticking = true;
        }
      });
    }
  });
</script>
